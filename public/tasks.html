<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>Задания - Magnum Coins</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='9731351' data-sdk='show_9731351'></script>
    <!-- Adstera SDK -->
    <script async="async" data-cfasync="false" src="//pl27442537.profitableratecpm.com/18dc4b75af6a5d63d9b595f478a96efe/invoke.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: -webkit-linear-gradient(90deg,#1f2c51,#1f2c51,#000000);
            background: linear-gradient(90deg,#1f2c51,#1f2c51,#000000);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding-top: 20px;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .task-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
        }

        .task-description {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .task-reward {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .task-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .task-button:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .task-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .dev-task {
            background: rgba(255, 193, 7, 0.2);
            border-color: #ffc107;
        }

        .dev-task .task-button {
            background: linear-gradient(45deg, #ffc107, #ff9800);
        }

        .cooldown-info {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .cooldown-info h3 {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .cooldown-info p {
            color: rgba(255, 255, 255, 0.8);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-panel h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .task-item {
                padding: 20px;
            }
            
            .task-title {
                font-size: 1.1rem;
            }
            
            .task-button {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }

        /* Анимированные часы */

        #h1, #h1-adstera {
            animation: rotate 60s linear infinite;
        }

        #h2, #h2-adstera {
            width: 45%;
            left: 5%;
            top: 45%;
            background-color: #636363;
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(90deg);
            }

            to {
                transform: rotate(450deg);
            }
        }

        /* Исправление позиционирования для миниатюрных часов */
        .cloader {
            width: 2em;
            height: 2em;
            border: 2px solid white;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
            padding: 0.5rem;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
            overflow: visible;
        }

        .clface {
            position: relative;
            width: 100%;
            height: 100%;
            transform: translateY(-1px);
        }

        .top {
            height: 4px;
            width: 2px;
            content: '';
            background-color: white;
            border-radius: 5em;
            margin-top: -12px;
            margin-left: 17px;
        }

        .bottom {
            height: 4px;
            width: 2px;
            content: '';
            background-color: white;
            border-radius: 5em;
            margin-top: 54px;
            margin-left: 17px;
        }

        .left {
            height: 2px;
            width: 4px;
            content: '';
            background-color: white;
            border-radius: 5em;
            margin-top: -33px;
            margin-left: 45px;
        }

        .right {
            height: 2px;
            width: 4px;
            content: '';
            background-color: white;
            border-radius: 5em;
            margin-top: -2px;
            margin-left: -14px;
        }

        .clsface {
            position: absolute;
            width: 16px;
            height: 16px;
            margin-left: 10px;
            margin-top: 6px;
            border-radius: 6em;
            border: 1px solid #636363;
        }

        .hand {
            width: 65%;
            height: 2px;
            background-color: white;
            border-radius: 3em;
            border: none;
            position: absolute;
            top: 85%;
            left: -15%;
            transform-origin: 100%;
            transform: rotate(90deg);
        }

        .pin {
            width: 25%;
            height: 25%;
            border-radius: 50%;
            background: white;
            position: absolute;
            top: 86%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #sub, #sub-adstera {
            width: 10%;
            height: 10%;
            border-radius: 50%;
            background: #636363;
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .cooldown-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        .cooldown-text {
            color: #ff6b6b;
            font-size: 14px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
            <button
                class="bg-white text-center w-36 rounded-xl h-12 relative text-black text-lg font-semibold group"
                type="button"
                onclick="goBack()"
            >
                <div
                    class="bg-green-400 rounded-lg h-10 w-1/4 flex items-center justify-center absolute left-1 top-[4px] group-hover:w-[132px] z-10 duration-500"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" height="20" width="20">
                        <path d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z" fill="#000"></path>
                        <path d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z" fill="#000"></path>
                    </svg>
                </div>
                <p class="translate-x-2">Назад</p>
            </button>
            <div class="header" style="flex:1;text-align:center;">
                <h1>🎯 Задания</h1>
                <p>Выполняйте задания и получайте награды!</p>
            </div>
        </div>

        <!-- Панель статистики -->
        <div class="stats-panel">
            <h3>📊 Ваша статистика</h3>
            <div class="stat-row">
                <span>💰 Монет:</span>
                <span id="coinsDisplay">0</span>
            </div>
            <div class="stat-row">
                <span>📺 Monetag реклам:</span>
                <span id="adsWatchedDisplay">0</span>
            </div>
            <div class="stat-row">
                <span>📺 Adstera реклам:</span>
                <span id="adsteraAdsWatchedDisplay">0</span>
            </div>
            <div class="stat-row">
                <span>✅ Заданий выполнено:</span>
                <span id="tasksCompletedDisplay">0</span>
            </div>
            <div class="stat-row">
                <span>⏰ Последняя Monetag:</span>
                <span id="lastAdDisplay">Никогда</span>
            </div>
            <div class="stat-row">
                <span>⏰ Последняя Adstera:</span>
                <span id="lastAdsteraDisplay">Никогда</span>
            </div>
        </div>

        <!-- Информация о кулдауне -->
        <div id="cooldownInfo" class="cooldown-info" style="display: none;">
            <h3>⏰ Время ожидания</h3>
            <p id="cooldownText">Подождите перед следующим просмотром рекламы</p>
        </div>

        <!-- Задания -->
        <div class="task-item">
            <div class="task-header">
                <div class="task-icon">📺</div>
                <div class="task-title">Смотреть рекламу Monetag</div>
            </div>
            <div class="task-description">
                Посмотрите рекламу Monetag и получите 50 монет! Реклама поможет вам быстро накопить монеты для покупки улучшений.
            </div>
            <div class="task-reward">💰 Награда: 50 монет</div>
            <button class="task-button" id="watchAdBtn">
                <span class="button-text">Смотреть рекламу</span>
                <div class="cooldown-container" style="display: none;">
                    <div class="cloader">
                        <div class="clface">
                            <div class="clsface">
                                <div id="h2" class="hand"></div>
                            </div>
                            <div class="top"></div>
                            <div class="bottom"></div>
                            <div class="left"></div>
                            <div class="right"></div>
                            <div id="sub" class="pin"></div>
                            <div id="h1" class="hand"></div>
                            <div id="main" class="pin"></div>
                        </div>
                    </div>
                    <span class="cooldown-text">Подождите</span>
                </div>
            </button>
        </div>

        <div class="task-item">
            <div class="task-header">
                <div class="task-icon">📺</div>
                <div class="task-title">Смотреть рекламу Adstera</div>
            </div>
            <div class="task-description">
                Посмотрите рекламу Adstera и получите 75 монет! Дополнительная возможность заработка с повышенной наградой.
            </div>
            <div class="task-reward">💰 Награда: 75 монет</div>
            <button class="task-button" id="watchAdsteraBtn">
                <span class="button-text">Смотреть рекламу Adstera</span>
                <div class="cooldown-container" style="display: none;">
                    <div class="cloader">
                        <div class="clface">
                            <div class="clsface">
                                <div id="h2-adstera" class="hand"></div>
                            </div>
                            <div class="top"></div>
                            <div class="bottom"></div>
                            <div class="left"></div>
                            <div class="right"></div>
                            <div id="sub-adstera" class="pin"></div>
                            <div id="h1-adstera" class="hand"></div>
                            <div id="main-adstera" class="pin"></div>
                        </div>
                    </div>
                    <span class="cooldown-text">Подождите</span>
                </div>
            </button>
        </div>

        <div class="task-item">
            <div class="task-header">
                <div class="task-icon">🎮</div>
                <div class="task-title">Играть в игру</div>
            </div>
            <div class="task-description">
                Завершите мини-игру и получите 100 монет! Увлекательные игры для дополнительного заработка.
            </div>
            <div class="task-reward">💰 Награда: 100 монет</div>
            <button class="task-button" id="playGameBtn">Играть</button>
        </div>

        <div class="task-item">
            <div class="task-header">
                <div class="task-icon">📱</div>
                <div class="task-title">Установить приложение</div>
            </div>
            <div class="task-description">
                Установите приложение и получите 200 монет! Отличный способ заработать много монет сразу.
            </div>
            <div class="task-reward">💰 Награда: 200 монет</div>
            <button class="task-button" id="installAppBtn">Установить</button>
        </div>

        <!-- Кнопка для сброса кулдауна (только для разработки) -->
        <div class="task-item dev-task">
            <div class="task-header">
                <div class="task-icon">🔄</div>
                <div class="task-title">Сбросить кулдаун рекламы</div>
            </div>
            <div class="task-description">
                Сбросить время ожидания для просмотра рекламы. Эта функция доступна только для тестирования.
            </div>
            <div class="task-reward">⚠️ Только для разработки</div>
            <button class="task-button" id="resetCooldownBtn">Сбросить</button>
        </div>
    </div>

    <!-- Контейнер для Adstera рекламы -->
    <div id="container-18dc4b75af6a5d63d9b595f478a96efe" style="display: none;"></div>

    <script>
        // Инициализация Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Игровые данные
        let gameData = {
            coins: 0,
            clicks: 0,
            coinsPerClick: 1,
            tasksCompleted: 0,
            adsWatched: 0,
            lastAdWatch: 0,
            adsteraAdsWatched: 0,
            lastAdsteraWatch: 0
        };

        // Настройки рекламы Monetag
        const AD_CONFIG = {
            zoneId: '9731351',
            rewardAmount: 50,
            cooldownMinutes: 1, // 60 секунд = 1 минута
            adDuration: 30
        };

        // Настройки рекламы Adstera
        const ADSTERA_CONFIG = {
            zoneId: '18dc4b75af6a5d63d9b595f478a96efe',
            containerId: 'container-18dc4b75af6a5d63d9b595f478a96efe',
            rewardAmount: 75,
            cooldownMinutes: 1, // 60 секунд = 1 минута
            adDuration: 25
        };

        // Загружаем сохраненные данные
        function loadGameData() {
            const saved = localStorage.getItem('magnumCoinsData');
            if (saved) {
                try {
                    const loadedData = JSON.parse(saved);
                    // Объединяем с дефолтными значениями для новых полей
                    gameData = {
                        coins: loadedData.coins || 0,
                        clicks: loadedData.clicks || 0,
                        coinsPerClick: loadedData.coinsPerClick || 1,
                        tasksCompleted: loadedData.tasksCompleted || 0,
                        adsWatched: loadedData.adsWatched || 0,
                        lastAdWatch: loadedData.lastAdWatch || 0,
                        adsteraAdsWatched: loadedData.adsteraAdsWatched || 0,
                        lastAdsteraWatch: loadedData.lastAdsteraWatch || 0
                    };
                } catch (error) {
                    console.error('Ошибка при загрузке данных:', error);
                    // Используем дефолтные значения при ошибке
                }
            }
            updateDisplay();
        }

        // Сохраняем данные
        function saveGameData() {
            localStorage.setItem('magnumCoinsData', JSON.stringify(gameData));
        }

        // Обновляем отображение
        function updateDisplay() {
            document.getElementById('coinsDisplay').textContent = gameData.coins.toLocaleString();
            document.getElementById('adsWatchedDisplay').textContent = gameData.adsWatched;
            document.getElementById('adsteraAdsWatchedDisplay').textContent = gameData.adsteraAdsWatched;
            document.getElementById('tasksCompletedDisplay').textContent = gameData.tasksCompleted;
            
            // Время последней рекламы Monetag
            if (gameData.lastAdWatch) {
                const timeSinceLastAd = Math.floor((Date.now() - gameData.lastAdWatch) / 1000 / 60);
                document.getElementById('lastAdDisplay').textContent = `${timeSinceLastAd} мин назад`;
            } else {
                document.getElementById('lastAdDisplay').textContent = 'Никогда';
            }

            // Время последней рекламы Adstera
            if (gameData.lastAdsteraWatch) {
                const timeSinceLastAdstera = Math.floor((Date.now() - gameData.lastAdsteraWatch) / 1000 / 60);
                document.getElementById('lastAdsteraDisplay').textContent = `${timeSinceLastAdstera} мин назад`;
            } else {
                document.getElementById('lastAdsteraDisplay').textContent = 'Никогда';
            }

            // Проверяем кулдауны
            checkCooldown();
            checkAdsteraCooldown();
        }

        // Проверяем кулдаун рекламы Monetag
        function checkCooldown() {
            const cooldownInfo = document.getElementById('cooldownInfo');
            const watchAdBtn = document.getElementById('watchAdBtn');
            const buttonText = watchAdBtn.querySelector('.button-text');
            const cooldownContainer = watchAdBtn.querySelector('.cooldown-container');
            
            if (!canWatchAd()) {
                const now = Date.now();
                const cooldownMs = AD_CONFIG.cooldownMinutes * 60 * 1000;
                let remainingSeconds = 0;
                
                if (gameData.lastAdWatch && typeof gameData.lastAdWatch === 'number') {
                    remainingSeconds = Math.ceil((cooldownMs - (now - gameData.lastAdWatch)) / 1000);
                    remainingSeconds = Math.max(0, remainingSeconds);
                }
                
                cooldownInfo.style.display = 'block';
                document.getElementById('cooldownText').textContent = `Подождите еще ${Math.ceil(remainingSeconds / 60)} минут перед следующим просмотром рекламы Monetag`;
                watchAdBtn.disabled = true;
                buttonText.style.display = 'none';
                cooldownContainer.style.display = 'flex';
                
                // Обновляем анимацию часов
                updateClockAnimation(watchAdBtn, remainingSeconds);
            } else {
                cooldownInfo.style.display = 'none';
                watchAdBtn.disabled = false;
                buttonText.style.display = 'block';
                cooldownContainer.style.display = 'none';
            }
        }

        // Проверяем кулдаун рекламы Adstera
        function checkAdsteraCooldown() {
            const watchAdsteraBtn = document.getElementById('watchAdsteraBtn');
            const buttonText = watchAdsteraBtn.querySelector('.button-text');
            const cooldownContainer = watchAdsteraBtn.querySelector('.cooldown-container');
            
            if (!canWatchAdstera()) {
                const now = Date.now();
                const cooldownMs = ADSTERA_CONFIG.cooldownMinutes * 60 * 1000;
                let remainingSeconds = 0;
                
                if (gameData.lastAdsteraWatch && typeof gameData.lastAdsteraWatch === 'number') {
                    remainingSeconds = Math.ceil((cooldownMs - (now - gameData.lastAdsteraWatch)) / 1000);
                    remainingSeconds = Math.max(0, remainingSeconds);
                }
                
                watchAdsteraBtn.disabled = true;
                buttonText.style.display = 'none';
                cooldownContainer.style.display = 'flex';
                
                // Обновляем анимацию часов
                updateClockAnimation(watchAdsteraBtn, remainingSeconds);
            } else {
                watchAdsteraBtn.disabled = false;
                buttonText.style.display = 'block';
                cooldownContainer.style.display = 'none';
            }
        }

        // Проверяем, можно ли смотреть рекламу Monetag
        function canWatchAd() {
            const now = Date.now();
            const cooldownMs = AD_CONFIG.cooldownMinutes * 60 * 1000;
            
            if (!gameData.lastAdWatch || typeof gameData.lastAdWatch !== 'number') {
                return true;
            }
            
            return (now - gameData.lastAdWatch) >= cooldownMs;
        }

        // Проверяем, можно ли смотреть рекламу Adstera
        function canWatchAdstera() {
            const now = Date.now();
            const cooldownMs = ADSTERA_CONFIG.cooldownMinutes * 60 * 1000;
            
            if (!gameData.lastAdsteraWatch || typeof gameData.lastAdsteraWatch !== 'number') {
                return true;
            }
            
            return (now - gameData.lastAdsteraWatch) >= cooldownMs;
        }

        // Обновление анимации часов
        function updateClockAnimation(button, remainingSeconds) {
            const h1 = button.querySelector('#h1, #h1-adstera');
            const cooldownText = button.querySelector('.cooldown-text');
            
            if (h1 && cooldownText) {
                // Обновляем текст
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                cooldownText.textContent = `Подождите ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Сбрасываем и перезапускаем анимацию
                h1.style.animation = 'none';
                h1.offsetHeight; // Принудительный reflow
                
                // Устанавливаем новую анимацию
                const animationDuration = Math.max(1, remainingSeconds);
                h1.style.animation = `rotate ${animationDuration}s linear infinite`;
            }
        }

        // Обработчик просмотра рекламы Monetag
        function handleWatchAd() {
            if (!canWatchAd()) {
                return;
            }
            
            console.log('🔍 Проверка SDK Monetag...');
            console.log('window.show_9731351:', typeof window.show_9731351);
            console.log('Текущий домен:', window.location.hostname);
            
            if (typeof window.show_9731351 !== 'undefined') {
                console.log('✅ SDK загружен, запускаем рекламу...');
                try {
                    window.show_9731351().then(() => {
                        console.log('✅ Реклама завершена');
                        completeAdWatch();
                    }).catch((error) => {
                        console.error('❌ Ошибка рекламы:', error);
                        // Без alert: тихое уведомление через лог
                        if (navigator.vibrate) navigator.vibrate(30);
                    });
                } catch (error) {
                    console.error('❌ Ошибка при показе рекламы:', error);
                    if (navigator.vibrate) navigator.vibrate(30);
                }
            } else {
                console.log('⚠️ SDK не загружен');
                if (navigator.vibrate) navigator.vibrate(20);
            }
        }

        // Обработчик просмотра рекламы Adstera
        function handleWatchAdstera() {
            if (!canWatchAdstera()) {
                return;
            }
            
            console.log('🔍 Запуск рекламы Adstera...');
            
            try {
                showAdsteraAd();
            } catch (error) {
                console.error('❌ Ошибка при показе рекламы Adstera:', error);
                if (navigator.vibrate) navigator.vibrate(30);
            }
        }

        // Показ рекламы Adstera
        function showAdsteraAd() {
            const container = document.getElementById(ADSTERA_CONFIG.containerId);
            if (!container) {
                console.error('❌ Контейнер Adstera не найден');
                return;
            }
            
            // Показываем контейнер
            container.style.display = 'block';
            container.style.position = 'fixed';
            container.style.top = '0';
            container.style.left = '0';
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.zIndex = '10000';
            container.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';
            
            // Добавляем кнопку закрытия
            const closeButton = document.createElement('button');
            closeButton.textContent = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                color: white;
                font-size: 20px;
                cursor: pointer;
                z-index: 10001;
            `;
            
            closeButton.addEventListener('click', () => {
                hideAdsteraAd();
            });
            
            container.appendChild(closeButton);
            
            // Запускаем таймер для автоматического закрытия
            let countdown = ADSTERA_CONFIG.adDuration;
            const timerElement = document.createElement('div');
            timerElement.style.cssText = `
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 15px;
                border-radius: 20px;
                font-size: 16px;
                z-index: 10001;
            `;
            timerElement.textContent = `Закрытие через ${countdown} сек`;
            
            container.appendChild(timerElement);
            
            const timer = setInterval(() => {
                countdown--;
                timerElement.textContent = `Закрытие через ${countdown} сек`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    hideAdsteraAd();
                }
            }, 1000);
            
            // Сохраняем таймер для очистки
            container.dataset.timer = timer;
            
            console.log('✅ Реклама Adstera запущена');
        }

        // Скрытие рекламы Adstera
        function hideAdsteraAd() {
            const container = document.getElementById(ADSTERA_CONFIG.containerId);
            if (!container) return;
            
            // Очищаем таймер
            if (container.dataset.timer) {
                clearInterval(parseInt(container.dataset.timer));
                delete container.dataset.timer;
            }
            
            // Очищаем контейнер
            container.innerHTML = '';
            container.style.display = 'none';
            
            // Завершаем просмотр
            completeAdsteraWatch();
        }

        // Завершение просмотра рекламы Monetag
        function completeAdWatch() {
            gameData.coins += AD_CONFIG.rewardAmount;
            gameData.adsWatched++;
            gameData.tasksCompleted++;
            gameData.lastAdWatch = Date.now();
            
            updateDisplay();
            saveGameData();
            // Без alert
        }

        // Завершение просмотра рекламы Adstera
        function completeAdsteraWatch() {
            gameData.coins += ADSTERA_CONFIG.rewardAmount;
            gameData.adsteraAdsWatched++;
            gameData.tasksCompleted++;
            gameData.lastAdsteraWatch = Date.now();
            
            updateDisplay();
            saveGameData();
            
            // Уведомление о награде
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            console.log(`✅ Реклама Adstera завершена! Получено ${ADSTERA_CONFIG.rewardAmount} монет`);
        }

        // Сброс кулдауна (для разработки)
        function resetAdCooldown() {
            gameData.lastAdWatch = 0;
            saveGameData();
            updateDisplay();
            // Без alert
        }

        // Обработчики других заданий
        function handlePlayGame() {
            // Без alert, только заглушка
            if (navigator.vibrate) navigator.vibrate(20);
        }

        function handleInstallApp() {
            if (navigator.vibrate) navigator.vibrate(20);
        }

        // Возврат назад
        function goBack() {
            window.location.href = '/';
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Страница заданий загружена');
            
            // Загружаем данные
            loadGameData();
            
            // Привязываем обработчики
            document.getElementById('watchAdBtn').addEventListener('click', handleWatchAd);
            document.getElementById('watchAdsteraBtn').addEventListener('click', handleWatchAdstera);
            document.getElementById('playGameBtn').addEventListener('click', handlePlayGame);
            document.getElementById('installAppBtn').addEventListener('click', handleInstallApp);
            document.getElementById('resetCooldownBtn').addEventListener('click', resetAdCooldown);
            
            // Обновляем кулдаун каждую секунду для анимированных часов
            setInterval(() => {
                checkCooldown();
                checkAdsteraCooldown();
            }, 1000);
            
            // Проверяем SDK через 2 секунды
            setTimeout(() => {
                console.log('🔍 Проверка SDK Monetag при загрузке...');
                console.log('window.show_9731351:', typeof window.show_9731351);
                if (typeof window.show_9731351 === 'undefined') {
                    console.warn('⚠️ SDK Monetag не загружен!');
                } else {
                    console.log('✅ SDK Monetag загружен успешно!');
                }
            }, 2000);
        });
    </script>
</body>
</html>
